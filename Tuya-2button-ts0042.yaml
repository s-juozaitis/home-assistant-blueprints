blueprint:
  name: Tuya 2-Button Scene Switch (ZHA)
  description: Control lights with short/long press actions using a Tuya 2-Button Scene Switch via ZHA.
  domain: automation
  input:
    switch:
      name: Tuya 2-Button Scene Switch
      description: Select the switch device
      selector:
        device:
          integration: zha
    light_device:
      name: Light Device
      description: Select the light device to control
      selector:
        device:
          integration: zha
    button_one_short_press:
      name: Single Press - Button 1
      description: Action to run on button 1 (short press)
      default: []
      selector:
        action: {}
    button_two_short_press:
      name: Single Press - Button 2
      description: Action to run on button 2 (short press)
      default: []
      selector:
        action: {}
mode: restart
max_exceeded: silent

trigger:
  - platform: device
    device_id: !input switch
    domain: zha
    type: remote_button_short_press
    subtype: button_1
    id: button_1
  - platform: device
    device_id: !input switch
    domain: zha
    type: remote_button_short_press
    subtype: button_2
    id: button_2
  - platform: device
    device_id: !input switch
    domain: zha
    type: remote_button_long_press
    subtype: button_1
    id: button_1_long
  - platform: device
    device_id: !input switch
    domain: zha
    type: remote_button_long_press
    subtype: button_2
    id: button_2_long

action:
  - choose:
      - conditions:
          - condition: trigger
            id: button_1
        sequence: !input button_one_short_press
      - conditions:
          - condition: trigger
            id: button_2
        sequence: !input button_two_short_press
      - conditions:
          - condition: trigger
            id: button_1_long
        sequence:
          - repeat:
              until:
                - condition: template
                  value_template: "{{ state_attr('light.' + (light_device | device_entities | select('search', 'light') | list | first), 'brightness') | int >= 255 }}"
              sequence:
                - service: light.turn_on
                  data:
                    brightness_step: 20
                  target:
                    device_id: !input light_device
                - delay: "00:00:01"
      - conditions:
          - condition: trigger
            id: button_2_long
        sequence:
          - repeat:
              until:
                - condition: template
                  value_template: "{{ state_attr('light.' + (light_device | device_entities | select('search', 'light') | list | first), 'brightness') | int <= 0 }}"
              sequence:
                - service: light.turn_on
                  data:
                    brightness_step: -20
                  target:
                    device_id: !input light_device
                - delay: "00:00:01"
